<div class="monitor-layout h-screen flex flex-column md:flex-row overflow-hidden">

  <div class="mobile-stats-header block md:hidden p-2">
    <app-activity-stats></app-activity-stats>
  </div>

  <div class="main-area flex-1 flex flex-column relative min-w-0 min-h-0 ">
    <div class="camera-selector p-2 flex gap-2 overflow-x-auto border-bottom-1 border-gray-800 flex-shrink-0">
      <button *ngFor="let cam of cameras()"
              class="p-button p-component p-button-sm white-space-nowrap"
              [class.p-button-outlined]="selectedCamera()?.id !== cam.id"
              [class.p-button-primary]="selectedCamera()?.id === cam.id"
              [class.p-button-secondary]="selectedCamera()?.id !== cam.id"
              (click)="selectCamera(cam)">
        <i class="pi pi-video mr-2"></i>
        {{ cam.display_name }}
      </button>
    </div>

    <div class="video-container flex-1 flex align-items-center justify-content-center overflow-hidden min-h-0 relative">
      <app-camera-widget
        *ngIf="selectedCamera()"
        [cameraId]="selectedCamera().id"
        [cameraName]="selectedCamera().display_name || selectedCamera().name"
        [autoConnect]="true"
        class="w-full h-full block">
      </app-camera-widget>
    </div>
  </div>

  <div class="mobile-order-list block md:hidden h-18rem bg-gray-50 border-top-1 border-gray-300 flex flex-column shadow-2 z-2">
    <div class="p-2 flex justify-content-between align-items-center bg-white border-bottom-1 border-gray-200 flex-shrink-0">
        <div class="flex align-items-center gap-2">
            <span class="font-bold text-gray-700 text-sm uppercase">üî¥ ƒêang ƒë√≥ng g√≥i</span>
            <span class="bg-red-500 text-white text-xs px-2 py-1 border-round font-bold">{{ activePackingOrders().length }}</span>
        </div>
        <button pButton icon="pi pi-refresh"
                class="p-button-rounded p-button-text p-button-sm p-button-secondary w-2rem h-2rem"
                [loading]="isListLoading()"
                (click)="loadInitialActiveOrders()"></button>
    </div>

    <div class="flex-1 overflow-y-auto p-2 custom-scroll">
        <div *ngIf="activePackingOrders().length === 0" class="text-center py-4 text-gray-400">
            <i class="pi pi-box text-3xl mb-2 opacity-50"></i>
            <p class="m-0 text-xs">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p>
        </div>

        <div *ngFor="let order of activePackingOrders(); trackBy: trackByOrder"
             class="active-card surface-card p-2 mb-2 border-round shadow-1 border-1 border-transparent flex gap-3 align-items-start active:bg-blue-50"
             (click)="selectCamera({id: order.camera_id, name: order.camera_name})">

             <div class="w-3rem h-3rem border-round bg-gray-200 overflow-hidden relative flex-shrink-0 border-1 border-gray-300 mt-1">
                <img *ngIf="order.avatar" [src]="order.avatar" class="w-full h-full object-cover">
                <div class="absolute inset-0 flex align-items-center justify-content-center text-gray-400" *ngIf="!order.avatar">
                    <i class="pi pi-image"></i>
                </div>
            </div>

            <div class="flex-1 min-w-0">
                <div class="font-bold text-900 text-sm white-space-nowrap overflow-hidden text-overflow-ellipsis">
                    {{ order.code }}
                </div>

                <div class="flex align-items-center gap-2 mt-1">
                    <span class="text-xs text-gray-500 flex align-items-center">
                        <i class="pi pi-video mr-1 text-xs"></i> {{ order.camera_name }}
                    </span>
                    <span class="text-xs text-blue-600 flex align-items-center" *ngIf="order.start_time">
                        <i class="pi pi-clock mr-1 text-xs"></i>
                        {{ order.start_time | appTimeFormat }}
                    </span>
                </div>

                <div *ngIf="order.note" class="text-xs text-orange-600 mt-1 white-space-nowrap overflow-hidden text-overflow-ellipsis">
                    <i class="pi pi-tag mr-1 text-xs"></i> {{ order.note }}
                </div>
            </div>
        </div>
    </div>
  </div>

  <div class="right-sidebar hidden md:flex flex-column w-20rem xl:w-24rem surface-section border-left-1 border-gray-700 shadow-4 z-2">

    <div class="sidebar-header p-3 border-bottom-1 border-gray-200">
      <h3 class="text-gray-600 text-sm font-bold uppercase mb-3 ml-1">T·ªïng quan h√¥m nay</h3>
      <app-activity-stats></app-activity-stats>
    </div>

    <div class="sidebar-content flex-1 flex flex-column min-h-0 bg-gray-50">
      <div class="p-3 pb-2 flex align-items-center justify-content-between">
        <h3 class="text-red-500 text-sm font-bold uppercase m-0 flex align-items-center gap-2">
          <span>üî¥ ƒêang ƒë√≥ng g√≥i</span>
          <span class="bg-red-500 text-white text-xs px-2 py-1 border-round">{{ activePackingOrders().length }}</span>
        </h3>

        <button pButton icon="pi pi-refresh"
                class="p-button-rounded p-button-text p-button-sm p-button-secondary"
                [loading]="isListLoading()"
                (click)="loadInitialActiveOrders()"
                pTooltip="L√†m m·ªõi"></button>
      </div>

      <p-scrollPanel [style]="{width: '100%', height: '100%'}" styleClass="custom-scroll">
        <div class="p-3 flex flex-column gap-3">

          <div *ngIf="activePackingOrders().length === 0" class="text-center py-6 text-gray-400">
            <i class="pi pi-box text-5xl mb-3 opacity-50"></i>
            <p class="m-0">T·∫•t c·∫£ c√°c line ƒëang ch·ªù...</p>
          </div>

          <div *ngFor="let order of activePackingOrders(); trackBy: trackByOrder"
               class="active-card surface-card p-3 border-round-xl shadow-1 border-1 border-transparent hover:border-blue-500 cursor-pointer transition-all transition-duration-200"
               (click)="selectCamera({id: order.camera_id, name: order.camera_name})">

            <div class="flex justify-content-between align-items-center mb-2">
              <span class="text-xs font-bold text-gray-500 flex align-items-center">
                <i class="pi pi-video mr-1"></i> {{ order.camera_name }}
              </span>
              <span class="text-xs bg-green-100 text-green-600 font-bold px-2 py-1 border-round">
                PACKING
              </span>
            </div>

            <div class="flex gap-3">
              <div class="w-4rem h-4rem border-round-lg bg-gray-200 overflow-hidden flex-shrink-0 relative shadow-1">
                <img *ngIf="order.avatar" [src]="order.avatar"
                     class="w-full h-full object-cover animate-fade-in"
                     onError="this.style.display='none'">
                <div class="absolute inset-0 flex align-items-center justify-content-center text-gray-400" *ngIf="!order.avatar">
                  <i class="pi pi-image text-xl"></i>
                </div>
              </div>

              <div class="flex-1 min-w-0 flex flex-column justify-content-center">
                <div class="font-bold text-lg text-900 white-space-nowrap overflow-hidden text-overflow-ellipsis mb-1"
                     [title]="order.code">
                  {{ order.code }}
                </div>

                <div class="flex flex-wrap gap-2 align-items-center">
                    <span class="text-xs text-gray-500">ID: #{{ order.order_id }}</span>
                    <span class="text-xs text-blue-600 flex align-items-center" *ngIf="order.start_time">
                        <i class="pi pi-clock mr-1 text-xs"></i>
                        {{ order.start_time | appTimeFormat }}
                    </span>
                </div>

                <div *ngIf="order.note" class="text-xs text-orange-600 mt-1 white-space-nowrap overflow-hidden text-overflow-ellipsis" [title]="order.note">
                    <i class="pi pi-tag mr-1 text-xs"></i> {{ order.note }}
                </div>
              </div>
            </div>

          </div>

        </div>
      </p-scrollPanel>
    </div>
  </div>

</div>
