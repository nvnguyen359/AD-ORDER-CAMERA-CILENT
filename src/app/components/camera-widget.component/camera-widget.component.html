<div class="cam-card" [class.recording]="isRecording()">
  <div class="cam-header">
    <div class="title">
      <strong>ğŸ“¸ Cam {{ cameraId }}</strong>

      @if (isRecording()) {
        <span class="badge-rec">
          REC {{ currentOrder()?.code ? ': ' + currentOrder()?.code : '' }}
        </span>
      }
    </div>

    <div class="controls">
      <select (change)="changeMode($event)">
        <option value="normal">Normal</option>
        <option value="scan">ğŸŸ¦ QR Scan</option>
        <option value="security">ğŸŸ¥ Security</option>
        <option value="both">ğŸŸª All (AI+QR)</option>
      </select>

      <button class="btn-icon" title="ToÃ n mÃ n hÃ¬nh" (click)="toggleFullscreen()">
        â›¶
      </button>

      @if (isStreaming()) {
        <button class="btn-icon danger" title="Táº¯t Camera" (click)="disconnect()">
          â›”
        </button>
      } @else {
        <button class="btn-icon success" title="Báº­t Camera" (click)="connect()">
          â–¶
        </button>
      }
    </div>
  </div>

  <div class="viewport" #viewport>

    @if (imageBase64()) {
      <img [src]="imageBase64()"
           (load)="onImageLoad($event)"
           alt="Live Stream">
    }

    @if (!imageBase64()) {
      <div class="placeholder">
        @if (!isStreaming()) {
            <p>Camera Ä‘ang táº¯t</p>
        } @else {
            <p>Äang káº¿t ná»‘i tÃ­n hiá»‡u...</p>
        }
      </div>
    }

    <canvas appVisualizer
            [metadata]="metadata()"
            [imgWidth]="imgWidth"
            [imgHeight]="imgHeight">
    </canvas>

    @if (currentOrder(); as order) {
      <div class="order-overlay">
        <div class="info-row">
          <span class="label">MÃ£ váº­n Ä‘Æ¡n:</span>
          <span class="value code">{{ order.code }}</span>
        </div>

        <div class="info-row">
          <span class="label">NhÃ¢n viÃªn:</span>
          <span class="value">{{ order.staffName || 'Unknown' }}</span>
        </div>

        @if (order.note) {
          <div class="info-row">
            <span class="label">Ghi chÃº:</span>
            <span class="value warning">{{ order.note }}</span>
          </div>
        }

        @if (order.startTime) {
          <div class="time-row">
             ğŸ•’ Báº¯t Ä‘áº§u: {{ order.startTime | date:'HH:mm:ss dd/MM' }}
          </div>
        }
      </div>
    }

  </div>
</div>
