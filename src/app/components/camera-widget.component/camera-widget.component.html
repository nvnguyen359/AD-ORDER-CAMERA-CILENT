<div class="cam-card" [class.recording]="isRecording()">
  <div class="cam-header">
    <div class="title">
      <strong>ðŸ“¸ Cam {{ cameraId }}</strong>

      <span *ngIf="isRecording()" class="badge-rec">
        REC {{ currentOrder()?.code ? ': ' + currentOrder()!.code : '' }}
      </span>
    </div>

    <div class="controls">
      <select (change)="changeMode($event)">
        <option value="normal">Normal</option>
        <option value="scan">ðŸŸ¦ QR Scan</option>
        <option value="security">ðŸŸ¥ Security</option>
        <option value="both">ðŸŸª All (AI+QR)</option>
      </select>

      <button class="btn-icon" title="ToÃ n mÃ n hÃ¬nh" (click)="toggleFullscreen()">
        â›¶
      </button>

      <button *ngIf="isConnected(); else btnConnect"
              class="btn-icon danger" title="Táº¯t Camera" (click)="disconnect()">
        â›”
      </button>
      <ng-template #btnConnect>
        <button class="btn-icon success" title="Báº­t Camera" (click)="connect()">
          â–¶
        </button>
      </ng-template>
    </div>
  </div>

  <div class="viewport" #viewport>
    <img *ngIf="imageBase64()"
         [src]="imageBase64()"
         (load)="onImageLoad($event)"
         alt="Live Stream">

    <div *ngIf="!imageBase64()" class="placeholder">
        <p>Signal Lost / Disconnected</p>
    </div>

    <canvas appVisualizer
            [metadata]="metadata()"
            [imgWidth]="imgWidth"
            [imgHeight]="imgHeight">
    </canvas>

    <div class="order-overlay" *ngIf="currentOrder()">
        <div class="info-row">
            <span class="label">MÃ£ váº­n Ä‘Æ¡n:</span>
            <span class="value code">{{ currentOrder()!.code }}</span>
        </div>
        <div class="info-row">
            <span class="label">NhÃ¢n viÃªn:</span>
            <span class="value">{{ currentOrder()!.staffName || 'Unknown' }}</span>
        </div>
        <div class="info-row" *ngIf="currentOrder()!.note">
            <span class="label">Ghi chÃº:</span>
            <span class="value warning">{{ currentOrder()!.note }}</span>
        </div>
        <div class="time-row">
             ðŸ•’ Báº¯t Ä‘áº§u: {{ currentOrder()!.startTime | date:'HH:mm:ss dd/MM' }}
        </div>
    </div>

  </div>
</div>
