<div class="card p-4 shadow-2 border-round-xl bg-white">
  <div class="flex justify-content-between align-items-center mb-4">
    <h2 class="m-0 text-2xl font-bold text-900">Quản lý Đóng gói</h2>
    <p-iconfield iconPosition="left">
      <p-inputicon class="pi pi-search" />
      <input pInputText type="text" placeholder="Tìm kiếm mã đơn..." class="w-20rem" (input)="onGlobalFilter($event)" />
    </p-iconfield>
  </div>

  <p-table sortMode="single" [scrollable]="true" scrollHeight="400px" [value]="orders()" [lazy]="true" #dt
    (onLazyLoad)="loadOrders($event)" [paginator]="true" [rows]="rows()" [totalRecords]="totalRecords()"
    [loading]="loading()" [showCurrentPageReport]="true"  [rowsPerPageOptions]="[ 20,50,100]"
    currentPageReportTemplate="Đang xem {first} đến {last} trong tổng số {totalRecords} mục" rowGroupMode="subheader"
    groupRowsBy="code" sortField="code" sortMode="single" styleClass="p-datatable-gridlines p-datatable-sm"
    [tableStyle]="{'min-width': '70rem'}">

    <ng-template pTemplate="header" #header>
      <tr>
        <th style="width: 5rem" class="text-center">STT</th>
        <th>Chi tiết phiên xử lý</th>
        <th style="width: 12rem">Thời lượng</th>
        <th style="width: 10rem" pSortableColumn="status">
          <div class="flex items-center gap-2">
            Trạng thái
            <p-sortIcon field="status" />
          </div>
        </th>
        <th style="width: 8rem" class="text-center">Thao tác</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="groupheader" let-order let-rowIndex="rowIndex">
      <tr class="bg-gray-50">
        <td class="text-center font-bold text-lg text-700">
          {{ rowIndex + 1 }}
        </td>
        <td colspan="4">
          <div class="flex align-items-center gap-3">
            <p-image [src]="order.full_avatar_path" width="45" [preview]="true"
              styleClass="border-round shadow-1 mr-2" />

            <div class="flex flex-column">
              <span class="font-bold text-blue-800 text-xl">
                {{ order.code || 'CHƯA CÓ MÃ' }}
              </span>
              <small class="text-500 italic">{{ order.note }}</small>
            </div>

            <div class="flex gap-4 ml-auto mr-4 font-medium text-700">
              <span><i class="pi pi-calendar mr-1"></i> {{ order.created_at | formatDateVN }}</span>
            </div>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-order>
      <tr>
        <td class="text-center text-400">
          <i class="pi pi-link text-xs"></i>
        </td>
        <td>
          <div class="flex flex-column">
            <span class="text-sm font-semibold">ID Phiên: #{{ order.id }}</span>
            <span class="text-xs text-500 ">Bắt đầu: {{ order.start_at |appTimeFormat}}</span>
          </div>
        </td>
        <td>
          <span [class]="order.duration === '---' ? 'text-400' : 'font-bold text-green-600'">
            <i class="pi pi-stopwatch mr-1"></i> {{ order.duration }}
          </span>
        </td>
        <td>
          <p-tag [value]="order.status.toUpperCase()|orderStatus" [severity]="getSeverity(order.status)" />
        </td>
        <td class="text-center">
          <div class="flex justify-content-center gap-2">
            <p-button icon="pi pi-video" [rounded]="true" [text]="true" severity="info" *ngIf="order.path_video" (click)="onPlayvideo(order)"
              pTooltip="Xem Video" />
            <p-button icon="pi pi-info-circle" [rounded]="true" [text]="true" severity="secondary"
              pTooltip="Chi tiết Metadata" />
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5" class="text-center p-5">Không có dữ liệu đơn hàng.</td>
      </tr>
    </ng-template>
  </p-table>
</div>
